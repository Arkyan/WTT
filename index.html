<html>

<head>
    <title>Triad Corporation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"
        integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">

    <script src="https://kit.fontawesome.com/88d1eb505e.js" crossorigin="anonymous"></script>

</head>

<body>
    <script src="./app.js"></script>
    <nav>
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>Triad Corporation</h1>

                    <div
                        style="background-color: rgba(95, 95, 95, 0.3); text-align: center; padding: 10px; border-radius: 10px;">
                        <a style="font-size: 30px; color: rgb(0, 0, 0, 0.65);" href="index.html"><i
                                class="fa-solid fa-house-user"></i> Menu&ensp;</a>
                        <a style="font-size: 30px; color: rgb(0, 0, 0, 0.65);" href="./Guide/TriadTips.html"><i
                                class="fa-solid fa-book-bookmark"></i>
                            Guide&ensp;</a>
                        <a style="font-size: 30px; color: rgb(0, 0, 0, 0.65);" href="./Forum/index.html"><i
                                class="fa-solid fa-users-line"></i>
                            Forum</a>
                    </div>

                </div>
            </div>
    </nav>

    <!-- Endroit dernieres actu -->
    <div class="container">
        <h3>Dernières actualitées</h3>
        <div class="row">
            <div class="col-md-4">
                <div class="thumbnail">
                    <img id="news_img1">
                    <div class="caption">
                        <h3 id="news_title1">Chargement...</h3>
                        <p id="news_description1">...</p>
                        <p><a id="news_link1" href="#" target="_blank" class="btn btn-primary" role="button">Lire la
                                suite</a></p>
                        <p id="news_date1">Date : </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="thumbnail">
                    <img id="news_img2">
                    <div class="caption">
                        <h3 id="news_title2">Cargement...</h3>
                        <p id="news_description2">...</p>
                        <p><a id="news_link2" href="#" target="_blank" class="btn btn-primary" role="button">Lire la
                                suite</a></p>
                        <p id="news_date2">Date : </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="thumbnail">
                    <img id="news_img3">
                    <div class="caption">
                        <h3 id="news_title3">Cargement...</h3>
                        <p id="news_description3">...</p>
                        <p><a id="news_link3" href="#" target="_blank" class="btn btn-primary" role="button">Lire la
                                suite</a></p>
                        <p id="news_date3">Date : </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Endroit statistiques du jeu -->
    <div class="container">
        <h3>Quelques statistiques</h3>
        <div class="row">
            <div class="col-md-4">
                <div class="thumbnail">
                    <div class="caption">
                        <h3><i class="fa-solid fa-person"></i> Visiteurs total : <h3 id="visiteurs">Chargement...</h3>
                        </h3>
                        </h3>
                        <p>Voici le nombre de visiteurs total depuis la création du site web</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="thumbnail">
                    <div class="caption">
                        <h3><i class="fa-regular fa-user"></i> Utilisateurs inscrits : <h3 id="utilisateurs">
                                Chargement...
                            </h3>
                        </h3>
                        </h3>
                        <p>Voici le nombre d'utilisateurs inscrits sur le site web</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="thumbnail">
                    <div class="caption">
                        <h3><i class="fa-solid fa-square-poll-horizontal"></i> Posts envoyés : <h3 id="posts">
                                Chargement...
                            </h3>
                        </h3>
                        </h3>
                        <p>Voici le nombre de posts envoyés sur le forum</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    // Fonction pour traiter le flux RSS
    function traiterFluxRSS(xml) {
        var items = xml.querySelectorAll("item");

        /*

        ################################################################################
        ############################## Article 1 #######################################
        ################################################################################

        */
        var titre1 = items[0].querySelector("title").textContent;
        var desc1 = items[0].querySelector("description").textContent;
        var link1 = items[0].querySelector("link").textContent;
        var date1 = items[0].querySelector("pubDate").textContent;

        desc1 = desc1.replace(/ *\[[^)]*\] */g, ""); //supprime les balises [ ... ]

        var regex = /<img[^>]+src="([^">]+)"/g; //permet de récupérer l'url de l'image
        for (let match of desc1.matchAll(regex)) {
            desc1 = desc1.replace(match[0], ""); //supprime l'image du texte
            document.getElementById("news_img1").src = match[0];
        }
        desc1 = desc1.replace(/\/>/g, ""); //supprime les balises img

        if (desc1.length > 400) { //si la description est trop longue, on la coupe
            desc1 = desc1.substring(0, 400) + "..."; //on coupe la description
        }

        document.getElementById("news_title1").innerHTML = titre1;
        document.getElementById("news_description1").innerHTML = desc1;
        document.getElementById("news_link1").href = link1;

        var date1_var = new Date(date1);
        var date1_final = date1_var.getDate() + "/" + (date1_var.getMonth() + 1) + "/" + date1_var.getFullYear() + " à " + date1_var.getHours() + "h" + date1_var.getMinutes();
        document.getElementById("news_date1").innerHTML = "Date : " + date1_final;

        /*

        ################################################################################
        ############################## Article 2 #######################################
        ################################################################################

        */

        var titre2 = items[1].querySelector("title").textContent;
        var desc2 = items[1].querySelector("description").textContent;

        var link2 = items[1].querySelector("link").textContent;
        var date2 = items[1].querySelector("pubDate").textContent;

        desc2 = desc2.replace(/ *\[[^)]*\] */g, ""); //supprime les balises [ ... ]

        var regex = /<img[^>]+src="([^">]+)"/g; //permet de récupérer l'url de l'image
        for (let match of desc2.matchAll(regex)) {
            desc2 = desc2.replace(match[0], ""); //supprime l'image du texte
            document.getElementById("news_img2").src = match[1] ?? "";
        }
        desc2 = desc2.replace(/\/>/g, ""); //supprime les balises img

        if (desc2.length > 400) { //si la description est trop longue, on la coupe
            desc2 = desc2.substring(0, 400) + "..."; //on coupe la description
        }

        document.getElementById("news_title2").innerHTML = titre2;
        document.getElementById("news_description2").innerHTML = desc2;
        document.getElementById("news_link2").href = link2;

        var date2_var = new Date(date2);
        var date2_final = date2_var.getDate() + "/" + (date2_var.getMonth() + 1) + "/" + date2_var.getFullYear() + " à " + date2_var.getHours() + "h" + date2_var.getMinutes();
        document.getElementById("news_date2").innerHTML = "Date : " + date2_final;

        /*

        ################################################################################
        ############################## Article 3 #######################################
        ################################################################################

        */

        var titre3 = items[2].querySelector("title").textContent;
        var desc3 = items[2].querySelector("description").textContent;
        var link3 = items[2].querySelector("link").textContent;
        var date3 = items[2].querySelector("pubDate").textContent;

        desc3 = desc3.replace(/ *\[[^)]*\] */g, ""); //supprime les balises [ ... ]

        var regex = /<img[^>]+src="([^">]+)"/g; //permet de récupérer l'url de l'image
        for (let match of desc3.matchAll(regex)) {
            desc3 = desc3.replace(match[0], ""); //supprime l'image du texte
            document.getElementById("news_img3").src = match[1] ?? "";
        }
        desc3 = desc3.replace(/\/>/g, ""); //supprime les balises img

        if (desc3.length > 400) { //si la description est trop longue, on la coupe
            desc3 = desc3.substring(0, 400) + "..."; //on coupe la description
        }
        document.getElementById("news_title3").innerHTML = titre3;
        document.getElementById("news_description3").innerHTML = desc3;
        document.getElementById("news_link3").href = link3;

        var date3_var = new Date(date3);
        var date3_final = date3_var.getDate() + "/" + (date3_var.getMonth() + 1) + "/" + date3_var.getFullYear() + " à " + date3_var.getHours() + "h" + date3_var.getMinutes();
        document.getElementById("news_date3").innerHTML = "Date : " + date3_final;
    }

    // Récupérer le flux RSS en utilisant XMLHttpRequest
    var xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function () {
        if (xhr.readyState == XMLHttpRequest.DONE) {
            if (xhr.status == 200) {
                // Convertir la réponse en XML
                var parser = new DOMParser();
                var xml = parser.parseFromString(xhr.responseText, "application/xml");

                // Appeler la fonction pour traiter le flux
                traiterFluxRSS(xml);
            } else {
                console.error("Erreur lors de la récupération du flux RSS");
            }
        }
    };
    xhr.open('GET', 'https://api.zehosting.fr/getnews');
    xhr.setRequestHeader("Authorization", "Basic " + btoa("miniprojet:2024"));
    xhr.send();

</script>

</html>